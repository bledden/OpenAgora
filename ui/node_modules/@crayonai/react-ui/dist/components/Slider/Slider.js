import { createElement as _createElement } from "react";
import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from "react/jsx-runtime";
import * as SliderPrimitive from "@radix-ui/react-slider";
import clsx from "clsx";
import { forwardRef, useMemo, useState } from "react";
const formatNumber = (num) => {
    if (num === undefined) {
        return "";
    }
    // format number to k, m, b
    if (num >= 1000) {
        return new Intl.NumberFormat("en-US", {
            notation: "compact",
            compactDisplay: "short",
        })
            .format(num)
            .toLowerCase();
    }
    return String(num);
};
export const Slider = forwardRef(({ variant, min, max, step, disabled, value, defaultValue, onValueChange, className, style, leftContent, rightContent, ...props }, ref) => {
    // used to show the correct value on thumb
    const [internalValue, setInternalValue] = useState(defaultValue && defaultValue.length > 0 ? defaultValue : [min]);
    const isControlled = value !== undefined;
    const valueToShow = isControlled ? value : internalValue;
    const isRange = valueToShow && valueToShow.length > 1;
    const thumbs = useMemo(() => {
        const thumbClass = "crayon-slider-thumb-handle";
        const valueIndicatorClass = "crayon-slider-thumb-value";
        if (isRange) {
            return (_jsx(_Fragment, { children: valueToShow?.map((v, i) => (_jsx(SliderPrimitive.Thumb, { className: "crayon-slider-thumb", children: _jsxs("div", { className: thumbClass, children: [_jsx("div", { className: "crayon-slider-thumb-handle-inner", children: _jsx("div", { className: "crayon-slider-thumb-handle-inner-dot" }) }), !disabled && _jsx("div", { className: valueIndicatorClass, children: formatNumber(v) })] }) }, i))) }));
        }
        return (_jsx(SliderPrimitive.Thumb, { className: "crayon-slider-thumb", children: _jsxs("div", { className: thumbClass, children: [_jsx("div", { className: "crayon-slider-thumb-handle-inner", children: _jsx("div", { className: "crayon-slider-thumb-handle-inner-dot" }) }), !disabled && (_jsx("div", { className: valueIndicatorClass, children: formatNumber(valueToShow?.[0]) }))] }) }));
    }, [disabled, valueToShow, isRange]);
    const renderDots = () => {
        if (variant === "discrete" && step) {
            const numSteps = Math.floor((max - min) / step);
            const currentValue = valueToShow?.[0] ?? min;
            return Array.from({ length: numSteps + 1 }, (_, index) => {
                const value = min + step * index;
                const position = ((value - min) / (max - min)) * 100;
                const isActive = isRange
                    ? value >= (valueToShow?.[0] ?? min) && value <= (valueToShow?.[1] ?? max)
                    : value <= currentValue;
                return (_jsx("div", { className: clsx("crayon-slider-dots-dot", {
                        "crayon-slider-dots-dot--active": isActive,
                    }), style: { left: `${position}%` } }, value));
            });
        }
        return null;
    };
    return (_jsxs("div", { className: "crayon-slider-wrapper", children: [leftContent && _jsx("div", { className: "crayon-slider-left-content", children: leftContent }), _jsxs("div", { className: "crayon-slider-container-wrapper", children: [_jsx("div", { className: "crayon-slider-container", children: _createElement(SliderPrimitive.Root, { ref: ref, className: clsx("crayon-slider-root", { "crayon-slider--disabled": disabled }, className), ...props, min: min, max: max, step: step, value: valueToShow, onValueChange: (val) => {
                                if (!isControlled) {
                                    setInternalValue(val);
                                }
                                onValueChange?.(val);
                            }, minStepsBetweenThumbs: 1, disabled: disabled, key: variant, style: style },
                            _jsxs(SliderPrimitive.Track, { className: "crayon-slider-track", children: [_jsx(SliderPrimitive.Range, { className: clsx("crayon-slider-range", {
                                            "crayon-slider-range--at-min": !isRange && valueToShow?.[0] === min,
                                        }) }), variant === "discrete" && renderDots()] }),
                            thumbs) }), _jsxs("div", { className: "crayon-slider-labels", children: [_jsx("span", { children: formatNumber(min) }), _jsx("span", { children: formatNumber(max) })] })] }), rightContent && _jsx("div", { className: "crayon-slider-right-content", children: rightContent })] }));
});
//# sourceMappingURL=Slider.js.map
import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import clsx from "clsx";
import { ChevronDownIcon, ChevronUpIcon } from "lucide-react";
import React, { memo, useCallback, useState } from "react";
import { Button } from "../../../Button/Button";
import { useDefaultLegend } from "./hooks/useDefaultLegend";
const DefaultLegend = memo(React.forwardRef(({ items, className, yAxisLabel, xAxisLabel, containerWidth, isExpanded, setIsExpanded, style, }, ref) => {
    const [buttonWidth, setButtonWidth] = useState(0);
    const { displayItems, hasMoreItems, toggleButtonText } = useDefaultLegend({
        items,
        containerWidth,
        buttonWidth,
        isExpanded,
    });
    // We use a callback ref to measure the button's width as soon as it's mounted.
    // This is more reliable than useEffect with ref.current in the dependency array,
    // as it correctly triggers a re-render when the node is available.
    // This is a workaround for the fact that the button's width is not available immediately.
    // and we need the actual button width to calculate the layout of the legend items.
    const buttonRef = useCallback((node) => {
        if (node) {
            if (node.clientWidth !== buttonWidth) {
                setButtonWidth(node.clientWidth);
            }
        }
    }, [buttonWidth]);
    const handleToggleExpanded = () => {
        setIsExpanded(!isExpanded);
    };
    const showToggleButton = hasMoreItems;
    return (_jsxs("div", { ref: ref, className: clsx("crayon-chart-legend-container crayon-chart-legend--bottom", className), style: style, children: [(xAxisLabel || yAxisLabel) && (_jsxs("div", { className: "crayon-chart-legend-axis-label-container", children: [xAxisLabel && (_jsxs("span", { className: "crayon-chart-legend-axis-label", children: ["X-Axis: ", _jsx("span", { className: "crayon-chart-legend-axis-label-text", children: xAxisLabel })] })), yAxisLabel && (_jsxs("span", { className: "crayon-chart-legend-axis-label", children: ["Y-Axis: ", _jsx("span", { className: "crayon-chart-legend-axis-label-text", children: yAxisLabel })] }))] })), _jsxs("div", { className: clsx("crayon-chart-legend", {
                    "crayon-chart-legend--expanded": isExpanded,
                    "crayon-chart-legend--collapsed": !isExpanded && showToggleButton,
                }), children: [displayItems.map((item) => (_jsxs("div", { className: "crayon-chart-legend-item", children: [item.icon ? (_jsx(item.icon, {})) : (_jsx("div", { className: "crayon-chart-legend-item-indicator", style: { backgroundColor: item.color } })), _jsxs("div", { className: "crayon-chart-legend-item-label-container", children: [_jsx("span", { className: "crayon-chart-legend-item-label", children: item.label }), item.percentage !== undefined && (_jsxs("span", { className: "crayon-chart-legend-item-percentage", children: [item.percentage.toFixed(1), "%"] }))] })] }, item.key))), showToggleButton && (_jsx(Button, { variant: "tertiary", size: "small", ref: buttonRef, className: "crayon-chart-legend-toggle-button", onClick: handleToggleExpanded, iconRight: isExpanded ? (_jsx(ChevronUpIcon, { className: "crayon-chart-legend-toggle-button-icon" })) : (_jsx(ChevronDownIcon, { className: "crayon-chart-legend-toggle-button-icon" })), children: toggleButtonText }))] })] }));
}));
DefaultLegend.displayName = "DefaultLegend";
export { DefaultLegend };
//# sourceMappingURL=DefaultLegend.js.map